name: Build

on:
  workflow_call:
    inputs:
      push_image:
        description: 'Push docker image to registry'
        required: false
        default: false
        type: boolean

  pull_request:
    branches: [develop, production, feature/azure-deploy, pr/jra/iac]

jobs:
  core-build:
    name: Build analog-core
    uses: ./.github/workflows/core-build.yml
    with:
      push_image: ${{ inputs.push_image }}
    secrets: inherit

  infra-build:
    name: Build infrastructure
    uses: ./.github/workflows/infra-build.yml
    secrets: inherit

  sonarcloud:
    name: Static code analysis
    uses: ./.github/workflows/core-sonarcloud.yml
    secrets: inherit